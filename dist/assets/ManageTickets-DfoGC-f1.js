var re=e=>{throw TypeError(e)};var q=(e,t,r)=>t.has(e)||re("Cannot "+r);var u=(e,t,r)=>(q(e,t,"read from private field"),r?r.call(e):t.get(e)),R=(e,t,r)=>t.has(e)?re("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),$=(e,t,r,s)=>(q(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),M=(e,t,r)=>(q(e,t,"access private method"),r);import{r as n,a2 as J,W as de,y as Q,q as Pe,s as Te,v as we,t as se,an as ke,ao as ae,ap as Re,aq as $e,ar as Me,as as ne,at as Be,au as me,av as pe,aw as _e,ax as Ae,a as Fe,j as o,ak as he,ab as be,z as U,S as ze,P as fe}from"./index-Djk7Ahjz.js";import{D as Xe,u as De,a as Ke,b as He,C as qe}from"./CustomTable-DE9BHKbn.js";import{R as Le,S as oe}from"./createLucideIcon-57TeRtfK.js";import{u as Ve}from"./useQuery-ijM2RuEA.js";import{u as Qe}from"./index-0n1dj9Dx.js";import{C as L}from"./CustomModal-Fdvh0Ewh.js";import{F as V,R as Ue,C as le}from"./index-DD_73l_5.js";import{I as ie}from"./index-DPcGVf0J.js";import"./index-BiTzRdp1.js";import"./Input-BWgNn_Ge.js";const z=({children:e})=>{const{getPrefixCls:t}=n.useContext(J),r=t("breadcrumb");return n.createElement("li",{className:`${r}-separator`,"aria-hidden":"true"},e===""?e:e||"/")};z.__ANT_BREADCRUMB_SEPARATOR=!0;var We=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(r[s[a]]=e[s[a]]);return r};function Ge(e,t){if(e.title===void 0||e.title===null)return null;const r=Object.keys(t).join("|");return typeof e.title=="object"?e.title:String(e.title).replace(new RegExp(`:(${r})`,"g"),(s,a)=>t[a]||s)}function ge(e,t,r,s){if(r==null)return null;const{className:a,onClick:i}=t,l=We(t,["className","onClick"]),d=Object.assign(Object.assign({},de(l,{data:!0,aria:!0})),{onClick:i});return s!==void 0?n.createElement("a",Object.assign({},d,{className:Q(`${e}-link`,a),href:s}),r):n.createElement("span",Object.assign({},d,{className:Q(`${e}-link`,a)}),r)}function Je(e,t){return(s,a,i,l,d)=>{if(t)return t(s,a,i,l);const y=Ge(s,a);return ge(e,s,y,d)}}var W=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(r[s[a]]=e[s[a]]);return r};const ye=e=>{const{prefixCls:t,separator:r="/",children:s,menu:a,overlay:i,dropdownProps:l,href:d}=e,v=(f=>{if(a||i){const c=Object.assign({},l);if(a){const m=a||{},{items:h}=m,g=W(m,["items"]);c.menu=Object.assign(Object.assign({},g),{items:h==null?void 0:h.map((j,x)=>{var{key:O,title:B,label:T,path:S}=j,p=W(j,["key","title","label","path"]);let b=T??B;return S&&(b=n.createElement("a",{href:`${d}${S}`},b)),Object.assign(Object.assign({},p),{key:O??x,label:b})})})}else i&&(c.overlay=i);return n.createElement(Xe,Object.assign({placement:"bottom"},c),n.createElement("span",{className:`${t}-overlay-link`},f,n.createElement(Le,null)))}return f})(s);return v!=null?n.createElement(n.Fragment,null,n.createElement("li",null,v),r&&n.createElement(z,null,r)):null},ve=e=>{const{prefixCls:t,children:r,href:s}=e,a=W(e,["prefixCls","children","href"]),{getPrefixCls:i}=n.useContext(J),l=i("breadcrumb",t);return n.createElement(ye,Object.assign({},a,{prefixCls:l}),ge(l,a,r,s))};ve.__ANT_BREADCRUMB_ITEM=!0;const Ye=e=>{const{componentCls:t,iconCls:r,calc:s}=e;return{[t]:Object.assign(Object.assign({},we(e)),{color:e.itemColor,fontSize:e.fontSize,[r]:{fontSize:e.iconFontSize},ol:{display:"flex",flexWrap:"wrap",margin:0,padding:0,listStyle:"none"},a:Object.assign({color:e.linkColor,transition:`color ${e.motionDurationMid}`,padding:`0 ${se(e.paddingXXS)}`,borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",marginInline:s(e.marginXXS).mul(-1).equal(),"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover}},ke(e)),"li:last-child":{color:e.lastItemColor},[`${t}-separator`]:{marginInline:e.separatorMargin,color:e.separatorColor},[`${t}-link`]:{[`
          > ${r} + span,
          > ${r} + a
        `]:{marginInlineStart:e.marginXXS}},[`${t}-overlay-link`]:{borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",padding:`0 ${se(e.paddingXXS)}`,marginInline:s(e.marginXXS).mul(-1).equal(),[`> ${r}`]:{marginInlineStart:e.marginXXS,fontSize:e.fontSizeIcon},"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover,a:{color:e.linkHoverColor}},a:{"&:hover":{backgroundColor:"transparent"}}},[`&${e.componentCls}-rtl`]:{direction:"rtl"}})}},Ze=e=>({itemColor:e.colorTextDescription,lastItemColor:e.colorText,iconFontSize:e.fontSize,linkColor:e.colorTextDescription,linkHoverColor:e.colorText,separatorColor:e.colorTextDescription,separatorMargin:e.marginXS}),et=Pe("Breadcrumb",e=>{const t=Te(e,{});return Ye(t)},Ze);var ce=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(r[s[a]]=e[s[a]]);return r};function tt(e){const{breadcrumbName:t,children:r}=e,s=ce(e,["breadcrumbName","children"]),a=Object.assign({title:t},s);return r&&(a.menu={items:r.map(i=>{var{breadcrumbName:l}=i,d=ce(i,["breadcrumbName"]);return Object.assign(Object.assign({},d),{title:l})})}),a}function rt(e,t){return n.useMemo(()=>e||(t?t.map(tt):null),[e,t])}var st=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(r[s[a]]=e[s[a]]);return r};const at=(e,t)=>{if(t===void 0)return t;let r=(t||"").replace(/^\//,"");return Object.keys(e).forEach(s=>{r=r.replace(`:${s}`,e[s])}),r},Y=e=>{const{prefixCls:t,separator:r="/",style:s,className:a,rootClassName:i,routes:l,items:d,children:y,itemRender:v,params:f={}}=e,c=st(e,["prefixCls","separator","style","className","rootClassName","routes","items","children","itemRender","params"]),{getPrefixCls:m,direction:h,breadcrumb:g}=n.useContext(J);let j;const x=m("breadcrumb",t),[O,B,T]=et(x),S=rt(d,l),p=Je(x,v);if(S&&S.length>0){const k=[],_=d||l;j=S.map((w,A)=>{const{path:je,key:X,type:xe,menu:Z,overlay:ee,onClick:Oe,className:Se,separator:Ee,dropdownProps:Ne}=w,D=at(f,je);D!==void 0&&k.push(D);const te=X??A;if(xe==="separator")return n.createElement(z,{key:te},Ee);const K={},Ie=A===S.length-1;Z?K.menu=Z:ee&&(K.overlay=ee);let{href:H}=w;return k.length&&D!==void 0&&(H=`#/${k.join("/")}`),n.createElement(ye,Object.assign({key:te},K,de(w,{data:!0,aria:!0}),{className:Se,dropdownProps:Ne,href:H,separator:Ie?"":r,onClick:Oe,prefixCls:x}),p(w,f,_,k,H))})}else if(y){const k=ae(y).length;j=ae(y).map((_,w)=>{if(!_)return _;const A=w===k-1;return Re(_,{separator:A?"":r,key:w})})}const b=Q(x,g==null?void 0:g.className,{[`${x}-rtl`]:h==="rtl"},a,i,B,T),Ce=Object.assign(Object.assign({},g==null?void 0:g.style),s);return O(n.createElement("nav",Object.assign({className:b,style:Ce},c),n.createElement("ol",null,j)))};Y.Item=ve;Y.Separator=z;var E,P,C,N,I,F,G,ue,nt=(ue=class extends $e{constructor(t,r){super();R(this,I);R(this,E);R(this,P);R(this,C);R(this,N);$(this,E,t),this.setOptions(r),this.bindMethods(),M(this,I,F).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const r=this.options;this.options=u(this,E).defaultMutationOptions(t),Me(this.options,r)||u(this,E).getMutationCache().notify({type:"observerOptionsUpdated",mutation:u(this,C),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&ne(r.mutationKey)!==ne(this.options.mutationKey)?this.reset():((s=u(this,C))==null?void 0:s.state.status)==="pending"&&u(this,C).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=u(this,C))==null||t.removeObserver(this)}onMutationUpdate(t){M(this,I,F).call(this),M(this,I,G).call(this,t)}getCurrentResult(){return u(this,P)}reset(){var t;(t=u(this,C))==null||t.removeObserver(this),$(this,C,void 0),M(this,I,F).call(this),M(this,I,G).call(this)}mutate(t,r){var s;return $(this,N,r),(s=u(this,C))==null||s.removeObserver(this),$(this,C,u(this,E).getMutationCache().build(u(this,E),this.options)),u(this,C).addObserver(this),u(this,C).execute(t)}},E=new WeakMap,P=new WeakMap,C=new WeakMap,N=new WeakMap,I=new WeakSet,F=function(){var r;const t=((r=u(this,C))==null?void 0:r.state)??Be();$(this,P,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},G=function(t){me.batch(()=>{var r,s,a,i,l,d,y,v;if(u(this,N)&&this.hasListeners()){const f=u(this,P).variables,c=u(this,P).context,m={client:u(this,E),meta:this.options.meta,mutationKey:this.options.mutationKey};(t==null?void 0:t.type)==="success"?((s=(r=u(this,N)).onSuccess)==null||s.call(r,t.data,f,c,m),(i=(a=u(this,N)).onSettled)==null||i.call(a,t.data,null,f,c,m)):(t==null?void 0:t.type)==="error"&&((d=(l=u(this,N)).onError)==null||d.call(l,t.error,f,c,m),(v=(y=u(this,N)).onSettled)==null||v.call(y,void 0,t.error,f,c,m))}this.listeners.forEach(f=>{f(u(this,P))})})},ue);function ot(e,t){const r=pe(),[s]=n.useState(()=>new nt(r,e));n.useEffect(()=>{s.setOptions(e)},[s,e]);const a=n.useSyncExternalStore(n.useCallback(l=>s.subscribe(me.batchCalls(l)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),i=n.useCallback((l,d)=>{s.mutate(l,d).catch(_e)},[s]);if(a.error&&Ae(s.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:i,mutateAsync:a.mutate}}const lt=({items:e,className:t})=>{const r=Fe(),s=e==null?void 0:e.map(a=>{const i=(a==null?void 0:a.link)!==null&&(a==null?void 0:a.link)!==void 0;return{title:a.name,onClick:()=>{i&&r(a.link)},className:`text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white ${i?"cursor-pointer":"cursor-default"}`}});return o.jsx(Y,{separator:">",className:t,items:s})},it=(e,{signal:t})=>he(`${be}/api/v1/tickets/get-all`,e,{signal:t}),ct=(e,{signal:t})=>he(`${be}/api/v1/tickets/create`,{...e,status:"open"},{signal:t}),ut=e=>{const t=Ve({queryKey:["tickets","getAllTickets",e],queryFn:({signal:r})=>{const s=Object.fromEntries(Object.entries(e).filter(([a,i])=>i&&i!==void 0&&i!==null));return it({filters:s},{signal:r})},enabled:!!e,staleTime:2e3,retry:!1,placeholderData:r=>r});return n.useEffect(()=>{var r;t.isError&&U.error(((r=t.error)==null?void 0:r.message)||"Failed to fetch tickets")},[t.error,t.isError]),t},dt=({isEdit:e,onHide:t})=>{const[r,s]=n.useState({subject:"",description:"",status:""}),[a,i]=n.useState({}),l=pe(),d=ot({mutationFn:({payload:c,signal:m})=>ct(c,{signal:m}),onSuccess:()=>{U.success("Ticket created successfully!"),l.invalidateQueries({queryKey:["tickets"]}),t()},onError:c=>{U.error((c==null?void 0:c.message)||"Failed to create ticket")}}),y=(c,m)=>{switch(c){case"subject":if(!m.trim())return"Title is required";if(m.length<3)return"Title must be at least 3 characters";break}},v=n.useCallback(async()=>{const c={};if(["subject","description"].forEach(j=>{const x=r[j],O=y(j,x??"");O&&(c[j]=O)}),i(c),Object.keys(c).length!==0)return;const{status:h,...g}=r;d.mutate({payload:g,signal:new AbortController().signal})},[r,d]),f=n.useCallback(c=>{const{name:m,value:h}=c.target;i(g=>({...g,[m]:y(m,h)})),s(g=>({...g,[m]:h}))},[]);return o.jsxs(L,{open:!0,handleClose:t,title:`${e?"Edit":"Create"} Ticket`,children:[o.jsx(L.Body,{children:o.jsxs(V,{onFinish:v,noValidate:!0,children:[o.jsx(V.Item,{label:"Title",validateStatus:a.subject?"error":"",help:a.subject,className:"mb-3",children:o.jsx(ie,{type:"text",placeholder:"Enter title",name:"subject",value:r.subject,onChange:f})}),o.jsx(V.Item,{label:"Description",validateStatus:a.description?"error":"",help:a.description,className:"mb-3",children:o.jsx(ie.TextArea,{rows:3,placeholder:"Enter description",name:"description",value:r.description,onChange:f})})]})}),o.jsx(L.Footer,{children:o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx(ze,{onClick:t,children:"Cancel"}),o.jsx(fe,{className:"!bg-[#252b61] border-0 !border-transparent !text-white",type:"button",onClick:v,children:"Submit"})]})})]})},Ot=()=>{const[e,t]=n.useState(20),[r,s]=n.useState(1),[a,i]=n.useState(""),[l,d]=n.useState({status:{label:"All",value:""},channel:{label:"All",value:""}}),{activeTypes:y,pop:v,push:f}=De(["createTicket"]),c=n.useMemo(()=>{var p,b;return{page:r,count:e,search_text:a,channel:(p=l==null?void 0:l.channel)==null?void 0:p.value,status:(b=l==null?void 0:l.status)==null?void 0:b.value,from:"vendor"}},[e,r,a,l]),m=Qe(c,500),{data:h,isFetching:g}=ut(m),j=[{label:"All",value:""},{label:"In Progress",value:"in-progress"},{label:"Open",value:"open"},{label:"Closed",value:"closed"}],x=[{label:"All",value:""},{label:"Email",value:"email"},{label:"Call",value:"call"}],O=(p,b)=>{t(b),s(p)};console.log("page",r,e);const B=p=>{const b="text-white p-2 rounded-sm";switch(p){case"open":return o.jsx("span",{className:`bg-green-500 ${b}`,children:"Open"});case"closed":return o.jsx("span",{className:`bg-red-500 ${b}`,children:"Closed"});case"in-progress":return o.jsx("span",{className:`bg-yellow-500 ${b}`,children:"In Progress"});default:return o.jsx(o.Fragment,{children:"N/A"})}},T=[{label:"Id",key:"id",dataIndex:"id"},{label:"Subject",key:"subject",dataIndex:"subject"},{label:"Status",key:"status",render:p=>B(p==null?void 0:p.status)}],S=n.useMemo(()=>[{type:"createTicket",component:o.jsx(dt,{isEdit:!1,onHide:()=>v("createTicket")})}],[v]);return o.jsxs("div",{className:"freshbag-wrapper p-3",children:[o.jsx(lt,{items:[{name:"Home",link:"/"},{name:"Tickets",link:"/tickets"}]}),o.jsxs("h1",{children:["Tickets (",(h==null?void 0:h.data.total)??0,")"]}),o.jsxs(Ue,{className:"mb-3 items-end",children:[o.jsx(le,{span:18,children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Ke,{onSearch:p=>{i(p)},placeHolder:"Search for ticket",searchText:a}),o.jsx(oe,{allowClear:!0,labelInValue:!0,value:l.status,placeholder:"Select Status",onChange:p=>d(b=>({...b,status:p})),options:j,className:"delta-select select-filter",style:{minWidth:150}}),o.jsx(oe,{allowClear:!0,labelInValue:!0,value:l.channel,placeholder:"Select Channel",onChange:p=>d(b=>({...b,channel:p})),options:x,className:"delta-select select-filter",style:{minWidth:150}})]})}),o.jsx(le,{span:6,children:o.jsx("div",{className:" flex justify-end",children:o.jsx(fe,{onClick:()=>{f("createTicket")},className:"py-2",children:"Create Ticket"})})})]}),o.jsx("div",{children:o.jsx(He,{data:(h==null?void 0:h.data.tickets)??[],columns:T,showingName:"Tickets",isLoading:g,onPageChange:O,page:r,pageSize:e,total:(h==null?void 0:h.data.total)??0,pagination:!0})}),o.jsx(qe,{activeTypes:y,modals:S})]})};export{Ot as default};
