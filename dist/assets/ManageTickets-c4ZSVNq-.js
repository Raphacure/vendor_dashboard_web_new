import{r as l,C as z,S as G,e as A,g as de,m as me,b as pe,w as L,aO as be,aP as Q,n as fe,a as ge,j as n,aL as J,aE as Y,z as F,aQ as he,a8 as ye,P as Z}from"./index-PsMG3Zdc.js";import{f as je,c as Ce,d as xe,e as ve,C as Oe}from"./CustomTable-C963ltCQ.js";import{j as Se,S as q}from"./index-Ddh1qbRu.js";import{u as Ne}from"./useQuery-BiTCPQsi.js";import{u as Ee,a as Ie}from"./index-C3Umt6vg.js";import{C as B}from"./CustomModal-D_U-XRhQ.js";import{F as _,R as Pe,C as K}from"./index-BbwYGjYS.js";import{I as W}from"./index-BdVFmmR4.js";import"./createLucideIcon-DgyBfDek.js";import"./index-B46B2bWJ.js";import"./Input-DN0wZSw7.js";import"./EyeOutlined-Bx_9SJyT.js";const T=({children:e})=>{const{getPrefixCls:s}=l.useContext(z),a=s("breadcrumb");return l.createElement("li",{className:`${a}-separator`,"aria-hidden":"true"},e===""?e:e||"/")};T.__ANT_BREADCRUMB_SEPARATOR=!0;var Te=function(e,s){var a={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&s.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,t=Object.getOwnPropertySymbols(e);r<t.length;r++)s.indexOf(t[r])<0&&Object.prototype.propertyIsEnumerable.call(e,t[r])&&(a[t[r]]=e[t[r]]);return a};function ke(e,s){if(e.title===void 0||e.title===null)return null;const a=Object.keys(s).join("|");return typeof e.title=="object"?e.title:String(e.title).replace(new RegExp(`:(${a})`,"g"),(t,r)=>s[r]||t)}function ee(e,s,a,t){if(a==null)return null;const{className:r,onClick:o}=s,c=Te(s,["className","onClick"]),p=Object.assign(Object.assign({},G(c,{data:!0,aria:!0})),{onClick:o});return t!==void 0?l.createElement("a",Object.assign({},p,{className:A(`${e}-link`,r),href:t}),a):l.createElement("span",Object.assign({},p,{className:A(`${e}-link`,r)}),a)}function we(e,s){return(t,r,o,c,p)=>{if(s)return s(t,r,o,c);const h=ke(t,r);return ee(e,t,h,p)}}var M=function(e,s){var a={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&s.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,t=Object.getOwnPropertySymbols(e);r<t.length;r++)s.indexOf(t[r])<0&&Object.prototype.propertyIsEnumerable.call(e,t[r])&&(a[t[r]]=e[t[r]]);return a};const te=e=>{const{prefixCls:s,separator:a="/",children:t,menu:r,overlay:o,dropdownProps:c,href:p}=e,y=(C=>{if(r||o){const i=Object.assign({},c);if(r){const b=r||{},{items:d}=b,f=M(b,["items"]);i.menu=Object.assign(Object.assign({},f),{items:d==null?void 0:d.map((g,j)=>{var{key:x,title:E,label:O,path:v}=g,u=M(g,["key","title","label","path"]);let m=O??E;return v&&(m=l.createElement("a",{href:`${p}${v}`},m)),Object.assign(Object.assign({},u),{key:x??j,label:m})})})}else o&&(i.overlay=o);return l.createElement(je,Object.assign({placement:"bottom"},i),l.createElement("span",{className:`${s}-overlay-link`},C,l.createElement(Se,null)))}return C})(t);return y!=null?l.createElement(l.Fragment,null,l.createElement("li",null,y),a&&l.createElement(T,null,a)):null},re=e=>{const{prefixCls:s,children:a,href:t}=e,r=M(e,["prefixCls","children","href"]),{getPrefixCls:o}=l.useContext(z),c=o("breadcrumb",s);return l.createElement(te,Object.assign({},r,{prefixCls:c}),ee(c,r,a,t))};re.__ANT_BREADCRUMB_ITEM=!0;const $e=e=>{const{componentCls:s,iconCls:a,calc:t}=e;return{[s]:Object.assign(Object.assign({},pe(e)),{color:e.itemColor,fontSize:e.fontSize,[a]:{fontSize:e.iconFontSize},ol:{display:"flex",flexWrap:"wrap",margin:0,padding:0,listStyle:"none"},a:Object.assign({color:e.linkColor,transition:`color ${e.motionDurationMid}`,padding:`0 ${L(e.paddingXXS)}`,borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",marginInline:t(e.marginXXS).mul(-1).equal(),"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover}},be(e)),"li:last-child":{color:e.lastItemColor},[`${s}-separator`]:{marginInline:e.separatorMargin,color:e.separatorColor},[`${s}-link`]:{[`
          > ${a} + span,
          > ${a} + a
        `]:{marginInlineStart:e.marginXXS}},[`${s}-overlay-link`]:{borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",padding:`0 ${L(e.paddingXXS)}`,marginInline:t(e.marginXXS).mul(-1).equal(),[`> ${a}`]:{marginInlineStart:e.marginXXS,fontSize:e.fontSizeIcon},"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover,a:{color:e.linkHoverColor}},a:{"&:hover":{backgroundColor:"transparent"}}},[`&${e.componentCls}-rtl`]:{direction:"rtl"}})}},Re=e=>({itemColor:e.colorTextDescription,lastItemColor:e.colorText,iconFontSize:e.fontSize,linkColor:e.colorTextDescription,linkHoverColor:e.colorText,separatorColor:e.colorTextDescription,separatorMargin:e.marginXS}),Be=de("Breadcrumb",e=>{const s=me(e,{});return $e(s)},Re);var U=function(e,s){var a={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&s.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,t=Object.getOwnPropertySymbols(e);r<t.length;r++)s.indexOf(t[r])<0&&Object.prototype.propertyIsEnumerable.call(e,t[r])&&(a[t[r]]=e[t[r]]);return a};function _e(e){const{breadcrumbName:s,children:a}=e,t=U(e,["breadcrumbName","children"]),r=Object.assign({title:s},t);return a&&(r.menu={items:a.map(o=>{var{breadcrumbName:c}=o,p=U(o,["breadcrumbName"]);return Object.assign(Object.assign({},p),{title:c})})}),r}function Ae(e,s){return l.useMemo(()=>e||(s?s.map(_e):null),[e,s])}var Fe=function(e,s){var a={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&s.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,t=Object.getOwnPropertySymbols(e);r<t.length;r++)s.indexOf(t[r])<0&&Object.prototype.propertyIsEnumerable.call(e,t[r])&&(a[t[r]]=e[t[r]]);return a};const Me=(e,s)=>{if(s===void 0)return s;let a=(s||"").replace(/^\//,"");return Object.keys(e).forEach(t=>{a=a.replace(`:${t}`,e[t])}),a},X=e=>{const{prefixCls:s,separator:a="/",style:t,className:r,rootClassName:o,routes:c,items:p,children:h,itemRender:y,params:C={}}=e,i=Fe(e,["prefixCls","separator","style","className","rootClassName","routes","items","children","itemRender","params"]),{getPrefixCls:b,direction:d,breadcrumb:f}=l.useContext(z);let g;const j=b("breadcrumb",s),[x,E,O]=Be(j),v=Ae(p,c),u=we(j,y);if(v&&v.length>0){const N=[],I=p||c;g=v.map((S,P)=>{const{path:se,key:k,type:ne,menu:H,overlay:D,onClick:le,className:oe,separator:ce,dropdownProps:ie}=S,w=Me(C,se);w!==void 0&&N.push(w);const V=k??P;if(ne==="separator")return l.createElement(T,{key:V},ce);const $={},ue=P===v.length-1;H?$.menu=H:D&&($.overlay=D);let{href:R}=S;return N.length&&w!==void 0&&(R=`#/${N.join("/")}`),l.createElement(te,Object.assign({key:V},$,G(S,{data:!0,aria:!0}),{className:oe,dropdownProps:ie,href:R,separator:ue?"":a,onClick:le,prefixCls:j}),u(S,C,I,N,R))})}else if(h){const N=Q(h).length;g=Q(h).map((I,S)=>{if(!I)return I;const P=S===N-1;return fe(I,{separator:P?"":a,key:S})})}const m=A(j,f==null?void 0:f.className,{[`${j}-rtl`]:d==="rtl"},r,o,E,O),ae=Object.assign(Object.assign({},f==null?void 0:f.style),t);return x(l.createElement("nav",Object.assign({className:m,style:ae},i),l.createElement("ol",null,g)))};X.Item=re;X.Separator=T;const ze=({items:e,className:s})=>{const a=ge(),t=e==null?void 0:e.map(r=>{const o=(r==null?void 0:r.link)!==null&&(r==null?void 0:r.link)!==void 0;return{title:r.name,onClick:()=>{o&&a(r.link)},className:`text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white ${o?"cursor-pointer":"cursor-default"}`}});return n.jsx(X,{separator:">",className:s,items:t})},Xe=(e,{signal:s})=>J(`${Y}/api/v1/tickets/get-all`,e,{signal:s}),He=(e,{signal:s})=>J(`${Y}/api/v1/tickets/create`,{...e,status:"open"},{signal:s}),De=e=>{const s=Ne({queryKey:["tickets","getAllTickets",e],queryFn:({signal:a})=>{const t=Object.fromEntries(Object.entries(e).filter(([r,o])=>o&&o!==void 0&&o!==null));return Xe({filters:t},{signal:a})},enabled:!!e,staleTime:2e3,retry:!1,placeholderData:a=>a});return l.useEffect(()=>{var a;s.isError&&F.error(((a=s.error)==null?void 0:a.message)||"Failed to fetch tickets")},[s.error,s.isError]),s},Ve=({isEdit:e,onHide:s})=>{const[a,t]=l.useState({subject:"",description:"",status:""}),[r,o]=l.useState({}),c=he(),p=Ee({mutationFn:({payload:i,signal:b})=>He(i,{signal:b}),onSuccess:()=>{F.success("Ticket created successfully!"),c.invalidateQueries({queryKey:["tickets"]}),s()},onError:i=>{F.error((i==null?void 0:i.message)||"Failed to create ticket")}}),h=(i,b)=>{switch(i){case"subject":if(!b.trim())return"Title is required";if(b.length<3)return"Title must be at least 3 characters";break}},y=l.useCallback(async()=>{const i={};if(["subject","description"].forEach(g=>{const j=a[g],x=h(g,j??"");x&&(i[g]=x)}),o(i),Object.keys(i).length!==0)return;const{status:d,...f}=a;p.mutate({payload:f,signal:new AbortController().signal})},[a,p]),C=l.useCallback(i=>{const{name:b,value:d}=i.target;o(f=>({...f,[b]:h(b,d)})),t(f=>({...f,[b]:d}))},[]);return n.jsxs(B,{open:!0,handleClose:s,title:`${e?"Edit":"Create"} Ticket`,children:[n.jsx(B.Body,{children:n.jsxs(_,{onFinish:y,noValidate:!0,children:[n.jsx(_.Item,{label:"Title",validateStatus:r.subject?"error":"",help:r.subject,className:"mb-3",children:n.jsx(W,{type:"text",placeholder:"Enter title",name:"subject",value:a.subject,onChange:C})}),n.jsx(_.Item,{label:"Description",validateStatus:r.description?"error":"",help:r.description,className:"mb-3",children:n.jsx(W.TextArea,{rows:3,placeholder:"Enter description",name:"description",value:a.description,onChange:C})})]})}),n.jsx(B.Footer,{children:n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(ye,{onClick:s,children:"Cancel"}),n.jsx(Z,{className:"!bg-[#252b61] border-0 !border-transparent !text-white",type:"button",onClick:y,children:"Submit"})]})})]})},rt=()=>{const[e,s]=l.useState(20),[a,t]=l.useState(1),[r,o]=l.useState(""),[c,p]=l.useState({status:{label:"All",value:""},channel:{label:"All",value:""}}),{activeTypes:h,pop:y,push:C}=Ce(["createTicket"]),i=l.useMemo(()=>{var u,m;return{page:a,count:e,search_text:r,channel:(u=c==null?void 0:c.channel)==null?void 0:u.value,status:(m=c==null?void 0:c.status)==null?void 0:m.value,from:"vendor"}},[e,a,r,c]),b=Ie(i,500),{data:d,isFetching:f}=De(b),g=[{label:"All",value:""},{label:"In Progress",value:"in-progress"},{label:"Open",value:"open"},{label:"Closed",value:"closed"}],j=[{label:"All",value:""},{label:"Email",value:"email"},{label:"Call",value:"call"}],x=(u,m)=>{s(m),t(u)};console.log("page",a,e);const E=u=>{const m="text-white p-2 rounded-sm";switch(u){case"open":return n.jsx("span",{className:`bg-green-500 ${m}`,children:"Open"});case"closed":return n.jsx("span",{className:`bg-red-500 ${m}`,children:"Closed"});case"in-progress":return n.jsx("span",{className:`bg-yellow-500 ${m}`,children:"In Progress"});default:return n.jsx(n.Fragment,{children:"N/A"})}},O=[{label:"Id",key:"id",dataIndex:"id"},{label:"Subject",key:"subject",dataIndex:"subject"},{label:"Status",key:"status",render:u=>E(u==null?void 0:u.status)}],v=l.useMemo(()=>[{type:"createTicket",component:n.jsx(Ve,{isEdit:!1,onHide:()=>y("createTicket")})}],[y]);return n.jsxs("div",{className:"freshbag-wrapper p-3",children:[n.jsx(ze,{items:[{name:"Home",link:"/"},{name:"Tickets",link:"/tickets"}]}),n.jsxs("h1",{children:["Tickets (",(d==null?void 0:d.data.total)??0,")"]}),n.jsxs(Pe,{className:"mb-3 items-end",children:[n.jsx(K,{span:18,children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(xe,{onSearch:u=>{o(u)},placeHolder:"Search for ticket",searchText:r}),n.jsx(q,{allowClear:!0,labelInValue:!0,value:c.status,placeholder:"Select Status",onChange:u=>p(m=>({...m,status:u})),options:g,className:"delta-select select-filter",style:{minWidth:150}}),n.jsx(q,{allowClear:!0,labelInValue:!0,value:c.channel,placeholder:"Select Channel",onChange:u=>p(m=>({...m,channel:u})),options:j,className:"delta-select select-filter",style:{minWidth:150}})]})}),n.jsx(K,{span:6,children:n.jsx("div",{className:" flex justify-end",children:n.jsx(Z,{onClick:()=>{C("createTicket")},className:"py-2",children:"Create Ticket"})})})]}),n.jsx("div",{children:n.jsx(ve,{data:(d==null?void 0:d.data.tickets)??[],columns:O,showingName:"Tickets",isLoading:f,onPageChange:x,page:a,pageSize:e,total:(d==null?void 0:d.data.total)??0,pagination:!0})}),n.jsx(Oe,{activeTypes:h,modals:v})]})};export{rt as default};
