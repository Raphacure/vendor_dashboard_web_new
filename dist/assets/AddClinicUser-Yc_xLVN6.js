import{r as j,bP as z,j as t,aH as O,e_ as J,d as se,u as ie,a as oe,ck as ae,k as re,L as ce,c_ as B,c$ as u,cL as c,bN as R,P as de,z as p,cK as le,e$ as me}from"./index-ChUmNm8R.js";import{S as pe}from"./SecoundaryButton-goiA8OO9.js";import{g as he}from"./ProfileService-D5sxIXUd.js";import{e as xe,s as ge,u as be}from"./doctorUsersService--bmGzTWH.js";import{C as fe}from"./CommonBreadCrumb-ZFUcDUQp.js";import{C as T}from"./CustomModal-Ds0Ku9jR.js";import{S as je}from"./index-v-CwiWzn.js";import{c as ye}from"./InputGroupContext-BUHt4CjC.js";import{U as ue}from"./index-BZKwATQs.js";import{B as D}from"./button-D0Rmo6Y5.js";import{R as we}from"./UploadOutlined-BeGctQLo.js";import"./DownOutlined-z3I3nDv9.js";import"./dropdown-C4zMWtkZ.js";import"./LeftOutlined-lLzXux5-.js";import"./collapse-BbEVqHco.js";import"./index-QWR8bAtG.js";import"./Upload-CTnVjxYJ.js";import"./fade-8FE2cY_X.js";import"./useForceUpdate-jQjUdsvY.js";import"./DeleteOutlined-LwZaW3bw.js";import"./EyeOutlined-BGetrG_9.js";import"./CheckOutlined-DPOLd74P.js";const _=j.forwardRef(({className:l,bsPrefix:b,as:y="span",...g},C)=>(b=z(b,"input-group-text"),t.jsx(y,{ref:C,className:O(l,b),...g})));_.displayName="InputGroupText";const Ce=l=>t.jsx(_,{children:t.jsx(J,{type:"checkbox",...l})}),Ne=l=>t.jsx(_,{children:t.jsx(J,{type:"radio",...l})}),H=j.forwardRef(({bsPrefix:l,size:b,hasValidation:y,className:g,as:C="div",...f},a)=>{l=z(l,"input-group");const N=j.useMemo(()=>({}),[]);return t.jsx(ye.Provider,{value:N,children:t.jsx(C,{ref:a,...f,className:O(g,l,b&&`${l}-${b}`,y&&"has-validation")})})});H.displayName="InputGroup";const ke=Object.assign(H,{Text:_,Radio:Ne,Checkbox:Ce}),Ie=se.div`
  padding: 2rem;

  .input-group-text {
    background-color: rgba(163, 218, 194, 1);
    cursor: pointer;
  }

  .row{
    margin-bottom:10px;
  }

  .form-btns{
    padding:.6rem 2rem;
  }

  .upload-btn{
    border:none;
    background-color: rgba(163, 218, 194, 1);
  }
  .ant-upload-wrapper{
    width:100%;
    display:block;
  }
  .ant-upload{
    width:100%;
  }

  .clinic-details-p {
    font-family: "Inter", sans-serif;
    font-weight: 500;
    font-size: 18px;
    letter-spacing: 0%;

    b {
      font-family: Inter;
      font-weight: 600;
      font-size: 22px;
      line-height: 100%;
      letter-spacing: 0%;
    }
  }

  .clinic-heading {
    font-size: 1.7rem;
    font-family: Inter;
    font-weight: 600;
    line-height: 100%;
    letter-spacing: 0%;
  }
`,Ke=()=>{var G,Y;const l=ie(),b=oe(),[y]=ae(),{type:g}=re(),[C,f]=j.useState(g==="edit"),[a,N]=j.useState({name:"",employee_id:"",country_code:"91",phone:"",dob:"",joining_date:"",email:"",department:"",subRole:"",image:""}),V=async()=>{var s,e,o,r,h,m;f(!0);try{const d=await l(xe({id:y.get("userId")}));if(d!=null&&d.error){p.error(((s=d==null?void 0:d.error)==null?void 0:s.message)??"unknown error occured");return}const i=(r=(o=(e=d==null?void 0:d.payload)==null?void 0:e.data)==null?void 0:o.user)==null?void 0:r[0];console.log("user",i);const x={name:`${i==null?void 0:i.first_name} ${i==null?void 0:i.last_name}`,country_code:(i==null?void 0:i.country_code)??"",phone:i==null?void 0:i.phone,dob:i==null?void 0:i.dob,joining_date:R(i==null?void 0:i.joining_date).format("YYYY-MM-DD"),email:i==null?void 0:i.email,subRole:(m=(h=i==null?void 0:i.roles)==null?void 0:h[0])==null?void 0:m.subRole,image:i==null?void 0:i.image,employee_id:i==null?void 0:i.employee_id};console.log("userDetails",x),q((i==null?void 0:i.active_status)==="active"),N(x)}catch{p.error("unknown error occured")}finally{f(!1)}};j.useEffect(()=>{g==="edit"&&y.get("userId")&&V()},[l]);const[n,E]=j.useState({}),[U,F]=j.useState([]),[K,P]=j.useState(!1),k=[{label:"Administrator",value:"administrator"},{label:"Hr",value:"hr"}];function A(s,e){var r,h,m,d,i,x,I,$,M;let o="";switch(s){case"name":(r=e==null?void 0:e.trim)!=null&&r.call(e)?isNaN(e==null?void 0:e.trim())||(o="Name should not be a number"):o="Name is required.";break;case"employee_id":(h=e==null?void 0:e.trim)!=null&&h.call(e)||(o="Employee ID is required.");break;case"country_code":(m=e==null?void 0:e.trim)!=null&&m.call(e)||(o="Country code is required.");break;case"phone":{const S=/^\d{10,}$/;(d=e==null?void 0:e.trim)!=null&&d.call(e)?S.test(e)||(o="Phone number must be at least 10 digits and contain only numbers."):o="Phone number is required.";break}case"dob":(i=e==null?void 0:e.trim)!=null&&i.call(e)||(o="Date of Birth is required.");break;case"joining_date":(x=e==null?void 0:e.trim)!=null&&x.call(e)||(o="Date of Join is required.");break;case"subRole":(I=e==null?void 0:e.trim)!=null&&I.call(e)||(o="Role is required.");break;case"email":{const S=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;($=e==null?void 0:e.trim)!=null&&$.call(e)?S.test(e)||(o="Invalid email format."):o="Email is required.";break}case"image":(M=e==null?void 0:e.trim)!=null&&M.call(e)||(o="Image is required.");break}return o}const w=s=>{const{name:e,value:o}=s.target,r=e.split(".");N(m=>{let d={...m},i=d;for(let x=0;x<r.length-1;x++)i[r[x]]||(i[r[x]]={}),i=i[r[x]];return i[r[r.length-1]]=o,d});const h=A(e,o);E(m=>({...m,[e]:h}))},Q=()=>{const s={};let e=!1;return["name","employee_id","country_code","phone","dob","joining_date","subRole","email","image"].forEach(r=>{const h=A(r,a[r]);h&&(s[r]=h,e=!0)}),E(s),{hasError:e,errors:s}},W=async()=>{var s,e;try{f(!0);const o={...a,role:"client_employee",department:"hr",password:"Raphacure@123"};console.log("formDataCopy",o);const r=await l(me(o));if(((s=r==null?void 0:r.meta)==null?void 0:s.requestStatus)!=="fulfilled"){p.error(((e=r==null?void 0:r.error)==null?void 0:e.message)||"Unknown Error Occured");return}p.success("User details saved successfully."),b("/manageUsers")}catch{p.error("unknown error occurred")}finally{f(!1)}},X=async()=>{var s,e;try{f(!0);const o={...a,department:"hr"},r=await l(be({payload:o,id:y.get("userId")}));if(((s=r==null?void 0:r.meta)==null?void 0:s.requestStatus)!=="fulfilled"){p.error(((e=r==null?void 0:r.error)==null?void 0:e.message)||"Unknown Error Occured");return}p.success("User details Edited successfully.",{style:{fontSize:"30px",padding:"20px"},position:"top-center"}),b("/manageUsers")}catch{p.error("unknown error occured")}finally{f(!1)}},Z=async()=>{const{hasError:s}=Q();if(s){p.error("Please fill all required fields.");return}g==="new"?W():g==="edit"&&X()},v=async s=>{var e,o,r,h;console.log("image",s);try{const m={id:`${s==null?void 0:s.uid}`,ext:".png"},d=await l(he(m)),i=JSON.parse(JSON.stringify(d)),x=(o=(e=i==null?void 0:i.payload)==null?void 0:e.signedUrL)==null?void 0:o.signedUrL,I=(h=(r=i==null?void 0:i.payload)==null?void 0:r.signedUrL)==null?void 0:h.publicUrl;return await le.put(x,s,{headers:{"Content-Type":"image/png"}}),console.log("Uploaded Image URL:",I),I}catch(m){throw console.error("Error uploading image to S3:",m),m}},ee=async s=>{if(s)try{const e=await v(s);p.success("image successfully uploaded"),N(o=>({...o,image:e})),e&&E(o=>({...o,image:""})),F([s])}catch{p.error("Error uploading front image. Please try again.")}return!1},te=(s,e)=>t.jsx("img",{src:s,alt:"preview",className:e}),[L,q]=j.useState(!1),ne=async s=>{var e;if(y.get("userId"))try{f(!0);const o=await l(ge({id:y.get("userId"),payload:{status:s?"active":"inactive"}}));if(o!=null&&o.error){p.error(((e=o==null?void 0:o.error)==null?void 0:e.message)||"unknown error");return}p.success("User InActive"),q(s)}catch{p.error("unknown error")}finally{f(!1)}};return console.log("formData",a),console.log("errors",n),t.jsxs(Ie,{children:[C&&t.jsx(ce,{}),t.jsx("h2",{className:"clinic-heading",children:"Manage Users"}),t.jsx(fe,{items:[{name:"Manage User",link:"/manageUsers"},{name:`${g==="new"?"Add":g==="edit"?"Edit":""} User`}]}),t.jsxs("div",{className:"my-3  flex justify-between items-center",children:[t.jsxs("h6",{className:"m-0",children:[g==="edit"?"Edit":"Add"," User Details"]}),g==="edit"&&t.jsxs("div",{className:"p-2 bg-[#edf8f3] rounded-2",children:[t.jsx(je,{value:L,onChange:ne})," ","User ",L?"Active":"InActive"]})]}),t.jsxs("div",{children:[t.jsxs(B,{children:[t.jsx(u,{md:3,children:t.jsxs(c.Group,{className:"mb-3",controlId:"formBasicClinicName",children:[t.jsxs(c.Label,{children:["Name",t.jsx("b",{className:"text-red-500 text-[14px]",children:" *"})]}),t.jsx(c.Control,{type:"text",name:"name",value:a==null?void 0:a.name,placeholder:"Enter User Name",onChange:w,isInvalid:!!(n!=null&&n.name)}),t.jsx(c.Control.Feedback,{type:"invalid",children:n==null?void 0:n.name})]})}),t.jsx(u,{md:3,children:t.jsxs(c.Group,{className:"mb-3",controlId:"formBasicClinicName",children:[t.jsxs(c.Label,{children:["Employee Id",t.jsx("b",{className:"text-red-500 text-[14px]",children:" *"})]}),t.jsx(c.Control,{type:"text",name:"employee_id",value:a==null?void 0:a.employee_id,placeholder:"Enter Employee Id",onChange:w,isInvalid:!!(n!=null&&n.employee_id)}),t.jsx(c.Control.Feedback,{type:"invalid",children:n==null?void 0:n.employee_id})]})}),t.jsx(u,{md:3,children:t.jsxs(c.Group,{className:"mb-3",controlId:"formBasicAlternateContact",children:[t.jsxs(c.Label,{className:"truncate w-[100%] !mb-[.3rem]",children:["Contact number",t.jsx("b",{className:"text-red-500 text-[14px]",children:" *"})]}),t.jsxs(ke,{hasValidation:!0,children:[t.jsx(c.Control,{name:"phone",maxLength:10,type:"number",onChange:s=>{s.target.value.length<=10&&w(s)},value:a==null?void 0:a.phone,placeholder:"Enter contact number",isInvalid:!!(n!=null&&n.phone)}),t.jsxs(c.Control.Feedback,{type:"invalid",children:[n==null?void 0:n.country_code," ",n==null?void 0:n.phone]})]})]})}),t.jsx(u,{md:3,children:t.jsxs(c.Group,{className:"mb-3",controlId:"formBasicEmail",children:[t.jsxs(c.Label,{children:["Date of Birth",t.jsx("b",{className:"text-red-500 text-[14px]",children:" *"})]}),t.jsx(c.Control,{name:"dob",type:"date",onChange:w,onClick:s=>{var e,o;(o=(e=s.currentTarget)==null?void 0:e.showPicker)==null||o.call(e)},value:a==null?void 0:a.dob,max:R().format("YYYY-MM-DD"),isInvalid:!!(n!=null&&n.dob)}),t.jsx(c.Control.Feedback,{type:"invalid",children:n==null?void 0:n.dob})]})})]}),t.jsxs(B,{children:[t.jsx(u,{md:3,children:t.jsxs(c.Group,{className:"mb-3",controlId:"formBasicEmail",children:[t.jsxs(c.Label,{children:["Date of Join",t.jsx("b",{className:"text-red-500 text-[14px]",children:" *"})]}),t.jsx(c.Control,{name:"joining_date",type:"date",onChange:w,onClick:s=>{var e,o;(o=(e=s.currentTarget)==null?void 0:e.showPicker)==null||o.call(e)},value:a==null?void 0:a.joining_date,isInvalid:!!(n!=null&&n.joining_date),max:R().format("YYYY-MM-DD")}),t.jsx(c.Control.Feedback,{type:"invalid",children:n==null?void 0:n.joining_date})]})}),t.jsx(u,{md:3,children:t.jsxs(c.Group,{className:"mb-3",controlId:"formBasicCity",children:[t.jsxs(c.Label,{children:["Email",t.jsx("b",{className:"text-red-500 text-[14px]",children:" *"})]}),t.jsx(c.Control,{name:"email",onChange:w,value:a==null?void 0:a.email,type:"text",placeholder:"Email address",isInvalid:!!(n!=null&&n.email)}),t.jsx(c.Control.Feedback,{type:"invalid",children:n==null?void 0:n.email})]})}),t.jsx(u,{md:3,children:t.jsxs(c.Group,{className:"mb-3",controlId:"formBasicPincode",children:[t.jsxs(c.Label,{children:["Role",t.jsx("b",{className:"text-red-500 text-[14px]",children:" *"})]}),t.jsxs(c.Select,{name:"subRole",onChange:w,value:a==null?void 0:a.subRole,"aria-label":"Role",isInvalid:!!(n!=null&&n.subRole),children:[t.jsx("option",{value:"",disabled:!0,children:"Select Role"}),(G=k==null?void 0:k.map)==null?void 0:G.call(k,s=>t.jsx("option",{value:s==null?void 0:s.value,children:s==null?void 0:s.label},s==null?void 0:s.value))]}),t.jsx(c.Control.Feedback,{type:"invalid",children:n==null?void 0:n.subRole})]})})]}),t.jsxs(B,{children:[t.jsxs(u,{md:3,children:[t.jsxs(c.Label,{className:"truncate w-[100%]",children:["Upload Profile",t.jsx("b",{className:"text-red-500 text-[14px]",children:" *"})]}),t.jsx("div",{className:`${n!=null&&n.image?"!border-red-500":""} border-1 rounded-[8px]`,children:t.jsx(ue,{accept:"image/*",maxCount:1,name:"registration_certificate",className:"block ",beforeUpload:ee,fileList:U,showUploadList:!1,onRemove:()=>F([]),children:t.jsxs("div",{className:"flex gap-2 border justify-between rounded",children:[t.jsx("div",{className:"grow truncate w-[100%]  flex items-center",children:((Y=U==null?void 0:U[0])==null?void 0:Y.name)??"Profile Photo"}),t.jsx(D,{className:"upload-btn",icon:t.jsx(we,{}),children:"Upload"})]})})}),(n==null?void 0:n.image)&&t.jsx("p",{className:"text-[var(--bs-form-invalid-color)] text-[.875em]",children:n==null?void 0:n.image}),t.jsx(T,{open:K&&(a==null?void 0:a.image),handleClose:()=>P(!1),title:"Uploaded File",children:t.jsx(T.Body,{children:t.jsx("div",{className:"file-preview mt-[10px] text-center",children:te(a==null?void 0:a.image,"h-32 w-32")})})})]}),(a==null?void 0:a.image)&&t.jsxs(u,{md:3,children:[t.jsx(c.Label,{className:"truncate w-[100%] !mb-[11px]",children:"Preview"}),t.jsx(D,{onClick:()=>P(!0),children:"show Preview"})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(pe,{type:"button",onClick:()=>b("/manageUsers"),className:"form-btns",children:"cancel"}),t.jsx(de,{type:"button",className:"form-btns",onClick:()=>Z(),children:"save"})]})})]})]})};export{Ke as default};
